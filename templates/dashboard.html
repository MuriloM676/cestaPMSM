<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Gestão de Cestas Básicas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Gestão de Cestas Básicas</h1>
    
    <!-- Formulário de Cadastro -->
    <div class="section-title">
        <h2>Cadastrar Novo Beneficiário</h2>
    </div>
    {% if error_message %}
        <div class="error-message">
            <span>⚠️</span> {{ error_message }}
        </div>
    {% endif %}
    <form method="POST" action="/cadastrar">
        <label>Nome:</label>
        <input type="text" name="nome" required>
        <label>Telefone:</label>
        <input type="text" name="telefone" required>
        <label>Endereço:</label>
        <textarea name="endereco" required></textarea>
        <button type="submit">Cadastrar</button>
    </form>

    <!-- Filtros -->
    <div class="section-title">
        <h2>Beneficiários Cadastrados</h2>
    </div>
    <form method="GET" action="/dashboard" class="filter-form">
        <div class="filter-group">
            <label for="nome">Filtrar por Nome:</label>
            <input type="text" id="nome" name="nome" value="{{ nome_filtro }}">
        </div>
        <div class="filter-group">
            <label for="telefone">Filtrar por Telefone:</label>
            <input type="text" id="telefone" name="telefone" value="{{ telefone_filtro }}">
        </div>
        <div class="filter-group">
            <label for="status">Status da Cesta:</label>
            <select id="status" name="status">
                <option value="todos" {% if status_filtro == 'todos' %}selected{% endif %}>Todos</option>
                <option value="retirada" {% if status_filtro == 'retirada' %}selected{% endif %}>Retirada</option>
                <option value="nao_retirada" {% if status_filtro == 'nao_retirada' %}selected{% endif %}>Não Retirada</option>
            </select>
        </div>
        <div class="filter-group">
            <button type="submit">Filtrar</button>
        </div>
    </form>

    <!-- Lista de Beneficiários -->
    <table>
        <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Telefone</th>
            <th>Endereço</th>
            <th>Cesta Retirada</th>
            <th>Ação</th>
        </tr>
        {% for beneficiario in beneficiarios %}
        <tr>
            <td>{{ beneficiario['id'] }}</td>
            <td>{{ beneficiario['nome'] }}</td>
            <td>{{ beneficiario['telefone'] }}</td>
            <td>{{ beneficiario['endereco'] }}</td>
            <td>{{ 'Sim' if beneficiario['cesta_retirada'] else 'Não' }}</td>
            <td>
                {% if not beneficiario['cesta_retirada'] %}
                <form method="POST" action="/marcar_retirada/{{ beneficiario['id'] }}">
                    <button type="submit">Marcar como Retirada</button>
                </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- Botão de Logout -->
    <a href="/logout">Sair</a>
</body>
</html>